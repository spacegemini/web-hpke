/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@hpke/chacha20poly1305@1.7.1/esm/mod.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{AeadId as e}from"./hpke_common.js";function t(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function r(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function n(e,t,r=""){const n=(o=e)instanceof Uint8Array||ArrayBuffer.isView(o)&&"Uint8Array"===o.constructor.name;var o;const i=e?.length,s=void 0!==t;if(!n||s&&i!==t){throw new Error((r&&`"${r}" `)+"expected Uint8Array"+(s?` of length ${t}`:"")+", got "+(n?`length=${i}`:"type="+typeof e))}return e}function o(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function i(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function s(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const a=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])();const u=(e,t)=>{function r(r,...o){if(n(r,void 0,"key"),!a)throw new Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){n(o[0],e.varSizeNonce?void 0:e.nonceLength,"nonce")}const i=e.tagLength;i&&void 0!==o[1]&&n(o[1],void 0,"AAD");const s=t(r,...o),u=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");n(t,void 0,"output")}};let c=!1;return{encrypt(e,t){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,n(e),u(s.encrypt.length,t),s.encrypt(e,t)},decrypt(e,t){if(n(e),i&&e.length<i)throw new Error('"ciphertext" expected length bigger than tagLength='+i);return u(s.decrypt.length,t),s.decrypt(e,t)}}}return Object.assign(r,e),r};function c(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw new Error("invalid output, must be aligned");return t}function l(e,r,n){t(n);const o=new Uint8Array(16),i=(s=o,new DataView(s.buffer,s.byteOffset,s.byteLength));var s;return i.setBigUint64(0,BigInt(r),n),i.setBigUint64(8,BigInt(e),n),o}function h(e){return Uint8Array.from(e)}const f=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),y=f("expand 16-byte k"),b=f("expand 32-byte k"),w=i(y),p=i(b);function d(e,t){return e<<t|e>>>32-t}function g(e){return e.byteOffset%4==0}const v=2**32-1,A=Uint32Array.of();function m(e,o){const{allowShortKeys:a,extendNonceFn:u,counterLength:c,counterRight:l,rounds:f}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},o);if("function"!=typeof e)throw new Error("core must be a function");return r(c),r(f),t(l),t(a),(t,o,y,b,d=0)=>{n(t,void 0,"key"),n(o,void 0,"nonce"),n(y,void 0,"data");const m=y.length;if(void 0===b&&(b=new Uint8Array(m)),n(b,void 0,"output"),r(d),d<0||d>=v)throw new Error("arx: counter overflow");if(b.length<m)throw new Error(`arx: output (${b.length}) is shorter than data (${m})`);const U=[],E=t.length;let x,k;if(32===E)U.push(x=h(t)),k=p;else{if(16!==E||!a)throw n(t,32,"arx key"),new Error("invalid key size");x=new Uint8Array(32),x.set(t),x.set(t,16),k=w,U.push(x)}g(o)||U.push(o=h(o));const L=i(x);if(u){if(24!==o.length)throw new Error("arx: extended nonce must be 24 bytes");u(k,L,i(o.subarray(0,16)),L),o=o.subarray(16)}const O=16-c;if(O!==o.length)throw new Error(`arx: nonce must be ${O} or 16 bytes`);if(12!==O){const e=new Uint8Array(12);e.set(o,l?0:12-o.length),o=e,U.push(o)}const j=i(o);return function(e,t,r,n,o,s,a,u){const c=o.length,l=new Uint8Array(64),h=i(l),f=g(o)&&g(s),y=f?i(o):A,b=f?i(s):A;for(let i=0;i<c;a++){if(e(t,r,n,h,a,u),a>=v)throw new Error("arx: counter overflow");const w=Math.min(64,c-i);if(f&&64===w){const e=i/4;if(i%4!=0)throw new Error("arx: invalid block position");for(let t,r=0;r<16;r++)t=e+r,b[t]=y[t]^h[r];i+=64}else{for(let e,t=0;t<w;t++)e=i+t,s[e]=o[e]^l[t];i+=w}}}(e,k,L,j,y,b,d,f),s(...U),b}}function U(e,t){return 255&e[t++]|(255&e[t++])<<8}class E{constructor(e){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:new Uint8Array(16)}),Object.defineProperty(this,"r",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"h",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"pad",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(8)}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=U(e=h(n(e,32,"key")),0),r=U(e,2),o=U(e,4),i=U(e,6),s=U(e,8),a=U(e,10),u=U(e,12),c=U(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|r<<3),this.r[2]=7939&(r>>>10|o<<6),this.r[3]=8191&(o>>>7|i<<9),this.r[4]=255&(i>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|a<<2),this.r[7]=8065&(a>>>11|u<<5),this.r[8]=8191&(u>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=U(e,16+2*t)}process(e,t,r=!1){const n=r?0:2048,{h:o,r:i}=this,s=i[0],a=i[1],u=i[2],c=i[3],l=i[4],h=i[5],f=i[6],y=i[7],b=i[8],w=i[9],p=U(e,t+0),d=U(e,t+2),g=U(e,t+4),v=U(e,t+6),A=U(e,t+8),m=U(e,t+10),E=U(e,t+12),x=U(e,t+14),k=o[0]+(8191&p),L=o[1]+(8191&(p>>>13|d<<3)),O=o[2]+(8191&(d>>>10|g<<6)),j=o[3]+(8191&(g>>>7|v<<9)),P=o[4]+(8191&(v>>>4|A<<12)),S=o[5]+(A>>>1&8191),z=o[6]+(8191&(A>>>14|m<<2)),_=o[7]+(8191&(m>>>11|E<<5)),$=o[8]+(8191&(E>>>8|x<<8)),I=o[9]+(x>>>5|n);let B=0,N=B+k*s+L*(5*w)+O*(5*b)+j*(5*y)+P*(5*f);B=N>>>13,N&=8191,N+=S*(5*h)+z*(5*l)+_*(5*c)+$*(5*u)+I*(5*a),B+=N>>>13,N&=8191;let C=B+k*a+L*s+O*(5*w)+j*(5*b)+P*(5*y);B=C>>>13,C&=8191,C+=S*(5*f)+z*(5*h)+_*(5*l)+$*(5*c)+I*(5*u),B+=C>>>13,C&=8191;let D=B+k*u+L*a+O*s+j*(5*w)+P*(5*b);B=D>>>13,D&=8191,D+=S*(5*y)+z*(5*f)+_*(5*h)+$*(5*l)+I*(5*c),B+=D>>>13,D&=8191;let K=B+k*c+L*u+O*a+j*s+P*(5*w);B=K>>>13,K&=8191,K+=S*(5*b)+z*(5*y)+_*(5*f)+$*(5*h)+I*(5*l),B+=K>>>13,K&=8191;let M=B+k*l+L*c+O*u+j*a+P*s;B=M>>>13,M&=8191,M+=S*(5*w)+z*(5*b)+_*(5*y)+$*(5*f)+I*(5*h),B+=M>>>13,M&=8191;let R=B+k*h+L*l+O*c+j*u+P*a;B=R>>>13,R&=8191,R+=S*s+z*(5*w)+_*(5*b)+$*(5*y)+I*(5*f),B+=R>>>13,R&=8191;let H=B+k*f+L*h+O*l+j*c+P*u;B=H>>>13,H&=8191,H+=S*a+z*s+_*(5*w)+$*(5*b)+I*(5*y),B+=H>>>13,H&=8191;let V=B+k*y+L*f+O*h+j*l+P*c;B=V>>>13,V&=8191,V+=S*u+z*a+_*s+$*(5*w)+I*(5*b),B+=V>>>13,V&=8191;let F=B+k*b+L*y+O*f+j*h+P*l;B=F>>>13,F&=8191,F+=S*c+z*u+_*a+$*s+I*(5*w),B+=F>>>13,F&=8191;let q=B+k*w+L*b+O*y+j*f+P*h;B=q>>>13,q&=8191,q+=S*l+z*c+_*u+$*a+I*s,B+=q>>>13,q&=8191,B=(B<<2)+B|0,B=B+N|0,N=8191&B,B>>>=13,C+=B,o[0]=N,o[1]=C,o[2]=D,o[3]=K,o[4]=M,o[5]=R,o[6]=H,o[7]=V,o[8]=F,o[9]=q}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let o=(1^n)-1;for(let e=0;e<10;e++)r[e]&=o;o=~o;for(let t=0;t<10;t++)e[t]=e[t]&o|r[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let i=e[0]+t[0];e[0]=65535&i;for(let r=1;r<8;r++)i=(e[r]+t[r]|0)+(i>>>16)|0,e[r]=65535&i;s(r)}update(e){o(this),n(e),e=h(e);const{buffer:t,blockLen:r}=this,i=e.length;for(let n=0;n<i;){const o=Math.min(r-this.pos,i-n);if(o!==r)t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(t,0,!1),this.pos=0);else for(;r<=i-n;n+=r)this.process(e,n)}return this}destroy(){s(this.h,this.r,this.buffer,this.pad)}digestInto(e){o(this),function(e,t){n(e,void 0,"output");const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let t=0;t<8;t++)e[s++]=r[t]>>>0,e[s++]=r[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}const x=(()=>function(e){const t=(t,r)=>e(r).update(t).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}((e=>new E(e))))();function k(e,t,r,n,o,i=20){const s=e[0],a=e[1],u=e[2],c=e[3],l=t[0],h=t[1],f=t[2],y=t[3],b=t[4],w=t[5],p=t[6],g=t[7],v=o,A=r[0],m=r[1],U=r[2];let E=s,x=a,k=u,L=c,O=l,j=h,P=f,S=y,z=b,_=w,$=p,I=g,B=v,N=A,C=m,D=U;for(let e=0;e<i;e+=2)E=E+O|0,B=d(B^E,16),z=z+B|0,O=d(O^z,12),E=E+O|0,B=d(B^E,8),z=z+B|0,O=d(O^z,7),x=x+j|0,N=d(N^x,16),_=_+N|0,j=d(j^_,12),x=x+j|0,N=d(N^x,8),_=_+N|0,j=d(j^_,7),k=k+P|0,C=d(C^k,16),$=$+C|0,P=d(P^$,12),k=k+P|0,C=d(C^k,8),$=$+C|0,P=d(P^$,7),L=L+S|0,D=d(D^L,16),I=I+D|0,S=d(S^I,12),L=L+S|0,D=d(D^L,8),I=I+D|0,S=d(S^I,7),E=E+j|0,D=d(D^E,16),$=$+D|0,j=d(j^$,12),E=E+j|0,D=d(D^E,8),$=$+D|0,j=d(j^$,7),x=x+P|0,B=d(B^x,16),I=I+B|0,P=d(P^I,12),x=x+P|0,B=d(B^x,8),I=I+B|0,P=d(P^I,7),k=k+S|0,N=d(N^k,16),z=z+N|0,S=d(S^z,12),k=k+S|0,N=d(N^k,8),z=z+N|0,S=d(S^z,7),L=L+O|0,C=d(C^L,16),_=_+C|0,O=d(O^_,12),L=L+O|0,C=d(C^L,8),_=_+C|0,O=d(O^_,7);let K=0;n[K++]=s+E|0,n[K++]=a+x|0,n[K++]=u+k|0,n[K++]=c+L|0,n[K++]=l+O|0,n[K++]=h+j|0,n[K++]=f+P|0,n[K++]=y+S|0,n[K++]=b+z|0,n[K++]=w+_|0,n[K++]=p+$|0,n[K++]=g+I|0,n[K++]=v+B|0,n[K++]=A+N|0,n[K++]=m+C|0,n[K++]=U+D|0}const L=m(k,{counterRight:!1,counterLength:4,allowShortKeys:!1}),O=new Uint8Array(16),j=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(O.subarray(r))},P=new Uint8Array(32);function S(e,t,r,o,i){void 0!==i&&n(i,void 0,"AAD");const a=e(t,r,P),u=l(o.length,i?i.length:0,!0),c=x.create(a);i&&j(c,i),j(c,o),c.update(u);const h=c.digest();return s(a,u),h}const z=u({blockSize:64,nonceLength:12,tagLength:16},(_=L,(e,t,r)=>{const n=16;return{encrypt(o,i){const a=o.length;(i=c(a+n,i,!1)).set(o);const u=i.subarray(0,-16);_(e,t,u,u,1);const l=S(_,e,t,u,r);return i.set(l,a),s(l),i},decrypt(o,i){i=c(o.length-n,i,!1);const a=o.subarray(0,-16),u=o.subarray(-16),l=S(_,e,t,a,r);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(u,l))throw new Error("invalid tag");return i.set(o.subarray(0,-16)),_(e,t,i,i,1),s(l),i}}}));var _;class ${constructor(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Uint8Array(e)}async seal(e,t,r){return await this._seal(e,t,r)}async open(e,t,r){return await this._open(e,t,r)}_seal(e,t,r){return new Promise((n=>{n(z(this._key,new Uint8Array(e),new Uint8Array(r)).encrypt(new Uint8Array(t)).buffer)}))}_open(e,t,r){return new Promise((n=>{n(z(this._key,new Uint8Array(e),new Uint8Array(r)).decrypt(new Uint8Array(t)).buffer)}))}}class I{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:e.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new $(e)}}export{I as Chacha20Poly1305};export default null;
//# sourceMappingURL=/sm/1ab8b3778928a7b23b0fadfbeec253d4f50c5a451d6a1bc03714730400c58a5a.map