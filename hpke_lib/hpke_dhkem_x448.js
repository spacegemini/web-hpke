/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@hpke/dhkem-x448@1.6.4/esm/mod.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{montgomery as e,pow2 as t,mod as r,HkdfSha512Native as i,hmac as n,sha512 as f,SerializeError as a,DeserializeError as c,XCryptoKey as s,KEM_USAGES as o,NotSupportedError as y,EMPTY as u,LABEL_DKP_PRK as h,LABEL_SK as l,DeriveKeyPairError as w,base64UrlToBytes as b,Dhkem as d,KemId as p}from"./hpke_common.js";const v=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),P=BigInt(1),m=BigInt(2),K=BigInt(3),g=BigInt(11),k=BigInt(22),_=BigInt(44),I=BigInt(88),S=BigInt(223);function z(e){return e[0]&=252,e[55]|=128,e[56]=0,e}const x=(()=>{const i=v;return e({P:i,type:"x448",powPminus2:e=>{const n=function(e){const r=v,i=e*e*e%r,n=i*i*e%r,f=t(n,K,r)*n%r,a=t(f,K,r)*n%r,c=t(a,m,r)*i%r,s=t(c,g,r)*c%r,o=t(s,k,r)*s%r,y=t(o,_,r)*o%r,u=t(y,I,r)*y%r,h=t(u,_,r)*o%r,l=t(h,m,r)*i%r,w=t(l,P,r)*e%r;return t(w,S,r)*l%r}(e),f=t(n,m,i);return r(f*e,i)},adjustScalarBytes:z})})();class B extends i{async extract(e,t){if(await this._setup(),0===e.byteLength&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return n(f,new Uint8Array(e),new Uint8Array(t)).buffer;const r=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",r,t)}}const j="X448";class E{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=56,this._nSk=56}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(e){throw new a(e)}}async deserializePublicKey(e){try{return await this._importRawKey(e,!0)}catch(e){throw new c(e)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(e){throw new a(e)}}async deserializePrivateKey(e){try{return await this._importRawKey(e,!1)}catch(e){throw new c(e)}}async importKey(e,t,r){try{if("raw"===e)return await this._importRawKey(t,r);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,r)}catch(e){throw new c(e)}}async generateKeyPair(){try{const e=await x.utils.randomSecretKey(),t=new s(j,e,"private",o);return{publicKey:await this.derivePublicKey(t),privateKey:t}}catch(e){throw new y(e)}}async deriveKeyPair(e){try{const t=await this._hkdf.labeledExtract(u.buffer,h,new Uint8Array(e)),r=await this._hkdf.labeledExpand(t,l,u,this._nSk),i=new s(j,new Uint8Array(r),"private",o);return{privateKey:i,publicKey:await this.derivePublicKey(i)}}catch(e){throw new w(e)}}async derivePublicKey(e){try{return await this._derivePublicKey(e)}catch(e){throw new c(e)}}async dh(e,t){try{return await this._dh(e,t)}catch(e){throw new a(e)}}_serializePublicKey(e){return new Promise((t=>{t(e.key.buffer)}))}_serializePrivateKey(e){return new Promise((t=>{t(e.key.buffer)}))}_importRawKey(e,t){return new Promise(((r,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid length of the key")),t||e.byteLength===this._nSk||i(new Error("Invalid length of the key")),r(new s(j,new Uint8Array(e),t?"public":"private",t?[]:o))}))}_importJWK(e,t){return new Promise(((r,i)=>{"OKP"!==e.kty&&i(new Error(`Invalid kty: ${e.kty}`)),"X448"!==e.crv&&i(new Error(`Invalid crv: ${e.crv}`)),t?(void 0!==e.d&&i(new Error("Invalid key: `d` should not be set")),"string"!=typeof e.x&&i(new Error("Invalid key: `x` not found")),r(new s(j,b(e.x),"public"))):("string"!=typeof e.d&&i(new Error("Invalid key: `d` not found")),r(new s(j,b(e.d),"private",o)))}))}_derivePublicKey(e){return new Promise(((t,r)=>{try{const r=x.getPublicKey(e.key);t(new s(j,r,"public"))}catch(e){r(e)}}))}_dh(e,t){return new Promise(((r,i)=>{try{r(x.getSharedSecret(e.key,t.key).buffer)}catch(e){i(e)}}))}}class O extends d{constructor(){const e=new B;super(p.DhkemX448HkdfSha512,new E(e),e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:p.DhkemX448HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56})}}export{O as DhkemX448HkdfSha512,B as HkdfSha512,E as X448};export default null;
//# sourceMappingURL=/sm/aa266b987b70889897d0216e1661ce76d80844923fc0738c1f9b59a85d648be6.map